---
title: 汇编笔记
description: 系统底层的学习记录
date: 2018-11-12 13:56:00
---

# 寄存器

## 关于栈

ESP: 栈指针寄存器(extended stack pointer) - 指向系统栈最上面一个栈帧的顶部（也是整个栈的顶部）  
EBP: 基址指针寄存器(extended base pointer) - 指向系统栈最上面一个栈帧的底部  
ESP与EBP之间的内存空间为当前栈帧。

EIP: 指令寄存器(extended instruction pointer) - 存放一个指针，指向等待执行的指令地址。

## 不常用寄存器

```asm
    CLD         ;clear flag DF
    pushf       ;将标志寄存器的值压栈
    popf        ;从栈中弹出数据，送入标志寄存器中。

    pushad      ;将所有寄存器压栈，执行后ESP=ESP-32（32位下）
                ;压栈顺序为EAX、ECX、EDX、EBX、ESP、EBP、ESI、EDI
    popad       ;对应pushad

    lodsb       ;将esi指向的地址处的数据取出来赋给AL寄存器
                ;然后esi=esi+1
    lodsw       ;与lodsb类似，操作的是字，赋值给AX
    lodsd       ;同上，赋值给EAX
    stosb       ;将AL寄存器的值取出来赋给edi所指向的地址处。
                ;即mov [edi]，AL与edi=edi+1
    stosw       ;
    stosd       ;
    ;这一组指令操控的是esi与edi

    cdq         ;Convert Double to Quad
                ;将双字数据扩展到四字
                ;将EAX的最高位拷贝到EDX的每一位
                ;如果EAX<0x8000_0000,EDX=0xFFFF_FFFF
                ;否则EDX=0x0000_0000
                ;如EAX存储-5即EAX=0xFFFF_FFFB
                ;则EDX=0xFFFF_FFFF
                ;两个寄存器合在一起就可以表示一个64位数

    movsx       ;先符号扩展再传送
                ;对于正数而言，符号扩展等于零扩展
                ;对于负数而言，将一个内存较小的值扩展到较大的内存里
                ;需要保留符号位，所以高位全部赋1
    movzx       ;先零扩展再传送
                ;低位直接拷贝，高位部分赋0
```

# 概念

文件偏移地址 = 虚拟内存地址(VA)-装载基址(Image Base)-节偏移